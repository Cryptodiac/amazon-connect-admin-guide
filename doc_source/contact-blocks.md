# Contact Block Definitions<a name="contact-blocks"></a>

Contact flows are created in the contact flow designer using action blocks, which you arrange by dragging and dropping them onto a canvas\. 

This topic describes all of the available action blocks\. 

**Note**  
When you set **User Defined** or **External** values in dynamic attribute fields, use only alphanumeric characters \(A\-Z, 0–9\) and periods\. No other characters are allowed\.

## Interact Blocks<a name="contact-interact"></a>


| Block | Action | Description | 
| --- | --- | --- | 
|  **Play prompt**  |  Plays an interruptible audio prompt, delivers a text\-to\-speech message, or delivers a chat response\.  |  When you use text \(for text\-to\-speech or chat\) you can use a maximum of 3,000 billed characters \(6,000 total characters\)\. You can also specify text in a flow using a contact attribute\. To learn how to record and upload an audio file, and add text\-to\-speech, see [Create Prompts](prompts.md)\.  | 
|  **Get customer input**  |  Branches based on customer intent\.  |  This action block includes the **Play prompt** in it: it plays an interruptible audio prompt, text\-to\-speech, or a chat message for a customer to respond to\. It then branches based on the customer's input\. The input can be DTMF, a chat response, or an Amazon Lex intent\. A sample configuration is shown in the following image\.  ![\[Image NOT FOUND\]](http://docs.aws.amazon.com/connect/latest/adminguide/images/get-customer-input-block.png) When you use text \(for text\-to\-speech or chat\) you can use a maximum of 3,000 billed characters \(6,000 total characters\)\. Amazon Lex bots support both spoken utterances and keypad input when used in a contact flow\.  You can prompt contacts to end their input with a pound key \# and to cancel it using the star key \*\.    | 
|  **Store customer input**  |  Stores numerical input to contact attribute\.  |  This action block is similar to **Get customer input**, only this one stores the input as a contact attribute and allows you to encrypt it\. This way you can encrypt sensitive input such as credit card numbers\.  It includes the **Play prompt**\.It plays an interruptible audio prompt, text\-to\-speech, or a chat message for a customer to respond to\.  You can specify the amount of time to wait for a customer to enter their reply by voice or chat, and whether to encrypt their reply\.  For detailed information about how to encrypt customer input, see [Creating a secure IVR solution with Amazon Connect](https://aws.amazon.com/blogs/contact-center/creating-a-secure-ivr-solution-with-amazon-connect/)\.  | 
|  **Loop prompts**  |  Loops a sequence of prompts while a customer or agent is on hold or in queue\.   |  When **Loop prompts** is used in a queue flow, audio playback can be interrupted with a flow at preset times\.  Always use an interruption period that's greater than 20 seconds\. This is the amount of time an available agent has to accept the contact\. If the interruption period is less than 20 seconds, you might get contacts going down the Error branch\. This is because Amazon Connect doesn't support dequeueing the customer when they are being routed to an active agent and are in the 20 second window to join\.  If this block is triggered during a chat conversation, the contact is routed down the Error branch\.   Some existing contact flows have a version of the **Loop prompts** block that doesn't have an error branch\. In this case, a chat contact stops execution of the customer queue flow\. The chat is routed when the next agent becomes available\.    | 
|  **Hold customer or agent**  |  Places a customer or agent on or off hold\.  |  Settings: Agent on hold / customer on call Customer on hold / agent on call Agent and customer on call If this block is triggered during a chat conversation, the contact is routed down the Error branch\.  | 
| **Call phone number** | Initiates an outbound call from an outbound whisper flow\. | Use the **Call phone number** block to place an outbound call\. This block is supported only in outbound whisper flows\. You can optionally set the phone number displayed as the caller ID number to a number from your instance, or to a number using an attribute\. The number must be in E\.164 format\. | 
| **Start media streaming** | Starts capturing customer audio for a contact\. | Captures customer audio during a contact\. You must enable Live media streaming to successfully capture customer audio\. Media streaming continues until a **Stop media streaming** block is used or the contact ends\. To learn more, see [Capture Customer Audio: Live Media Streaming](customer-voice-streams.md)\.  If this block is triggered during a chat conversation, the contact is routed down the Error branch\.  | 
| **Stop media streaming** | Stops capturing customer audio after it is started with a **Start media streaming** block\. | After it's started, media streaming continues, even when one contact flow transfer to another contact flow\. You must use a **Stop media streaming** block to stop media streaming\.  If this block is triggered during a chat conversation, the contact is routed down the Error branch\. | 

## Set Blocks<a name="contact-set"></a>


| Block | Action | Description | 
| --- | --- | --- | 
|  **Set working queue**  |  Specifies the queue to be used when **Transfer to queue** is invoked\.  |  A queue must be specified before invoking **Transfer to queue** except when used in a customer queue flow\. It’s also the default queue for checking attributes, such as staffing, queue status, and hours of operation\. To use a **Set working queue** block to set the queue dynamically, such as with contact attributes, you must specify the ARN for the queue rather than the queue name\. To find the ARN for a queue, open the queue in the queue editor\. The ARN is included as the last part of the URL displayed in the browser address bar after /queue\. For example, `.../queue/aaaaaaaa-bbbb-cccc-dddd-111111111111`\.   | 
|  **Set recording and analytics behavior**  |  Sets options for recording conversations\.  |  Enables or disables recording of the agent, customer, or both\. Let's say you have a flow that links to a flow that links to another flow\. Each flow might have it's own Set recording behavior block\. The last Set recording behavior block overrides the settings of the previous 2 Set recording behavior blocks\.  For example, you might have a contact flow with Set recording behavior to record Agent and Customer\. But if the next Set recording behavior block is set to Agent only, that block overrides the behavior of the previous block\.    | 
|  **Set contact attributes**  |  Stores key\-value pairs as contact attributes\.  |  Contact attributes are accessible by other areas of Amazon Connect, such as the CTRs\.  For more information about how to use contact attributes, see [Use Amazon Connect Contact Attributes](connect-contact-attributes.md)\.   | 
| Get queue metrics | Retrieves real\-time metrics about queues and agents in your contact center and returns them as attributes\. | Use a Check contact attributes block to check metric values and define routing logic based on them, such as number of contact in a queue, number of available agents, and oldest contact in a queue\. For more information, see [How to Use System Metric Attributes](attrib-system-metrics.md)\. | 
|  **Change routing priority / age**  |  Changes the priority of the contact in queue\. You may want to do this, for example, based on the contact's issue or other variable\.  |  This block gives you two options for changing a contact's position in queue:  [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/connect/latest/adminguide/contact-blocks.html) To view a sample flow that uses this block, see [Sample Queue Configurations](sample-queue-configurations.md)\.  | 
|  **Set hold flow**  |  Links from one contact flow type to another\.  |  Specifies the flow to invoke when a customer or agent is put on hold\.  If this block is triggered during a chat conversation, the contact is routed down the Error branch\.  | 
|  **Set whisper flow**  |  Overrides the default whisper by linking to a whisper flow\.  |  Specifies the whisper to be played to customer on an outbound call, or to the customer or agent when the call is joined\.  | 
|  **Set callback number**  |  Sets a callback number\.  |  Specifies the number to be used to call the customer back in the CCP, or when **Transfer to queue** is invoked with the callback option\. When specifying a phone number in Amazon Connect, the number must be in [E\.164 format](https://en.wikipedia.org/wiki/E.164)\. Numbers in E\.164 format do not include the leading zeroes you would dial for a local or regional call within the same country when dialing the number from a phone\. For example, if you usually dial 0400xxxxxx to place a call in Australia, the number in E\.164 format includes the country code of 61 and removes the leading zero for the number\. The number to use in Amazon Connect is **\+61400xxxxxx**\.  | 
|  **Set voice**  |  Sets the voice\.  |  Sets the voice to interact with the customer, and optionally the voice if using text\-to\-speech \(TTS\)\.  | 
|  **Set customer queue flow**  |  Set queue flow\.  |  Specifies the flow to invoke when a customer is transferred to a queue\.  | 
|  **Set disconnect flow**  |  Sets the flow to run when the agent disconnects from the chat\.  |  An example of when you would use **Set disconnect flow** is when a customer stops responding to the chat\. Use this block to decide whether to run the disconnect flow and call a [Wait](#wait) block, or end the conversation\.   | 

## Branch Blocks<a name="contact-branch"></a>


| Block | Action | Description | 
| --- | --- | --- | 
|  **Check queue status**  |  Checks the status of the queue based on specified conditions\.  |  Branches based on the comparison of **Time in Queue** or **Queue capacity**\. If no match is found, the **No Match** branch is followed\.  | 
|  **Check staffing**  |  Checks the current working queue, or queue you specify in the block, for whether agents are available, staffed \(on call, or after contact work status\), or online\.  |  Branches based on whether agents are available, staffed \(available, on call, and after contact work\), or online\.  You must set a queue before using a **Check staffing** block in your contact flow\. If a queue is not set, the block always proceeds through the error branch\. You can use a **Set working queue** block to set the queue\. When a contact is transferred from one flow to another, the queue that is set in a contact flow is passed from that flow to the next flow\.   | 
|  **Check hours of operation**  |  Checks to see whether the contact is occurring within or outside of the hours of operation defined for the queue\.  |  Branches based on specified hours of operation, either directly or as associated to a queue that is within open hours\.  Queues that are automatically created for each user in your instance do not include an Hours of operation\. If you use the block to check the Hours of operation for one of these queues, the check fails and the **Error** branch is followed\.   | 
|  **Check contact attributes**  |  Check the values of contact attributes\.  |  Branches based on a comparison to the value of a contact attribute\. Supported comparisons include: **Equals**, **Is Greater Than**, **Is Less Than**, **Starts With**, **Contains**\.  | 
|  **Distribute by percentage**  |  Routes customers randomly based on a percentage\.  |  Like flipping a coin, contacts are distributed randomly, which doesn’t guarantee exact percentage splits\.  | 
|  **Loop**  |   Loops through \(repeats\) the **Looping** branch for the number of loops specified\.  |   After the loops are completed, the **Complete** branch is followed\. If you enter 0 for the loop count, the **Complete** branch is followed the first time this block executes\.An example use of this block is to loop back to a **Get customer input** block to try to enter input, such as an account number, when an initial attempt does not succeed\.  | 
|  **Wait**  |  Pauses the contact flow\.  |  Use this block in chat contact flows only\. If a contact stops responding to a chat, this block pauses the contact flow for the specified wait time\. It has two branches:  [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/connect/latest/adminguide/contact-blocks.html) If this block is started during a voice conversation, the contact is routed down the Error branch\. You can add multiple **Wait** blocks to your contact flows\. For example:  [\[See the AWS documentation website for more details\]](http://docs.aws.amazon.com/connect/latest/adminguide/contact-blocks.html)  | 

## Integrate Block<a name="contact-integrate"></a>


| Block | Action | Description | 
| --- | --- | --- | 
|  **Invoke AWS Lambda function**  |  Makes a call to AWS Lambda, and optionally returns key\-value pairs\.  |  The returned key\-value pairs can be used to set contact attributes\. To use an AWS Lambda function in a contact flow, first add the function to your instance\. For more information, see [Add an AWS Lambda function to your instance](https://docs.aws.amazon.com/connect/latest/adminguide/amazon-connect-instance.html#aws-lambda)\. After you add the function to your instance, you can select the function from the **Select a function** drop\-down list in the block to use it in the contact flow\.  | 

## Terminate / Transfer Blocks<a name="contact-terminate"></a>


| Block | Action | Description | 
| --- | --- | --- | 
|  **Disconnect / hang up**  |  Terminates a customer contact\.  |  Disconnects the customer\.  | 
|  **Transfer to queue**  |  In most contact flows, this block ends the current contact flow and places the customer in queue\. When used in a customer queue flow, this block transfers a contact already in a queue to another queue\.  |  When used in most contact flows, a queue must be specified, using **Set working queue**, before invoking **Transfer to queue** except when used in a customer queue flow\. Optionally, the contact can be placed in queue to receive a callback, if a **Set customer callback number** block is used before this block in a flow\. When used in a customer queue flow, a **Loop prompts** block must be used prior to this block in the contact flow\.  | 
|  **Transfer to phone number**  |  Transfers the customer to a phone number external to your instance\.  |  Transfers the contact to the specified phone number\. You can choose to end the contact flow when the call is transferred, or choose to **Resume contact flow after disconnect**, which returns the caller to your instance and resumes the contact flow after the transferred call ends\. If the country you want to select is not listed, you can submit a request to add countries you want to transfer calls to using the [Amazon Connect service quotas increase form](https://console.aws.amazon.com/support/home#/case/create?issueType=service-limit-increase&limitType=service-code-connect)\.  If this block is triggered during a chat conversation, the contact is routed down the Error branch\.  | 
|  **Transfer to agent**  |  Transfers the customer to an agent\.  |  Ends the current contact flow and transfers the customer to an agent\. If the agent is already with someone else, the contact is disconnected\. The **Transfer to Agent** block is a beta feature and works only for voice interactions\. To transfer a chat contact to another agent, follow these instructions: [Using Contact Attributes to Route Contacts to a Specific Agent](transfer.md#use-attribs-agent-queue)\.  | 
|  **Transfer to flow**  |  Transfers the customer to another contact flow\.  |  Ends the current contact flow and transfers the customer to a different contact flow\. Available in transfer to agent and transfer to queue flows\.  | 
|  **End flow / Resume**  |  Ends the current flow without disconnecting the contact\.  |  When **End flow / Resume** is invoked, the customer remains connected to the system\. You might use this block, for example, when a **Loop prompts** block is interrupted\. You can return the customer to the **Loop prompts** block\.  | 